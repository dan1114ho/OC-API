import config from 'config';
import nock from 'nock';

export default function() {
  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/tokens',
      'card%5Bnumber%5D=4242424242424242&card%5Bexp_month%5D=12&card%5Bexp_year%5D=2028&card%5Bcvc%5D=222',
    )
    .reply(
      200,
      {
        id: 'tok_1Be9noDjPFcHOcTmT574CrEv',
        object: 'token',
        card: {
          id: 'card_1Be9nnDjPFcHOcTmEFRzpIXp',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'unchecked',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: 'ftgJeBXvQSZ4HMCg',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499880,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:40 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '781',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_VDp3BG377d0Gjq',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/tokens',
      'card%5Bnumber%5D=4242424242424242&card%5Bexp_month%5D=12&card%5Bexp_year%5D=2028&card%5Bcvc%5D=222',
    )
    .reply(
      200,
      {
        id: 'tok_1Be9npDjPFcHOcTmMt3wGsH7',
        object: 'token',
        card: {
          id: 'card_1Be9noDjPFcHOcTmQt0Rv1Ys',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'unchecked',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: 'ftgJeBXvQSZ4HMCg',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499881,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:41 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '781',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_1qqgZSHGoXNOOx',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('http://data.fixer.io', { encodedQueryParams: true })
    .get('/latest')
    .query({ access_key: config.fixer.accessKey, base: 'USD', symbols: 'EUR' })
    .reply(200, { base: 'USD', date: '2017-12-28', rates: { EUR: 0.83794 } }, [
      'Server',
      'nginx/1.13.6',
      'Date',
      'Thu, 28 Dec 2017 22:24:41 GMT',
      'Content-Type',
      'application/json',
      'Content-Length',
      '58',
      'Connection',
      'close',
      'Cache-Control',
      'public, must-revalidate, max-age=900',
      'Last-Modified',
      'Thu, 28 Dec 2017 00:00:00 GMT',
      'Vary',
      'Origin',
      'X-Content-Type-Options',
      'nosniff',
    ]);

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9npDjPFcHOcTmMt3wGsH7&description=https%3A%2F%2Fopencollective.com%2Fuser2&email=user2%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGqEhywR2I69',
        object: 'customer',
        account_balance: 0,
        created: 1514499882,
        currency: null,
        default_source: 'card_1Be9noDjPFcHOcTmQt0Rv1Ys',
        delinquent: false,
        description: 'https://opencollective.com/user2',
        discount: null,
        email: 'user2@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9noDjPFcHOcTmQt0Rv1Ys',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGqEhywR2I69',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: 'ftgJeBXvQSZ4HMCg',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGqEhywR2I69/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGqEhywR2I69/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:42 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_Kz7MSVeXM5KOXI',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post('/v1/tokens', 'customer=cus_C2EGqEhywR2I69')
    .reply(
      200,
      {
        id: 'tok_1Be9nrLzdXg9xKNSJtoc7HH4',
        object: 'token',
        card: {
          id: 'card_1Be9nrLzdXg9xKNS56Z60ndx',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499883,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:43 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '776',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_NZKsWSB4bojfyi',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9nrLzdXg9xKNSJtoc7HH4&description=https%3A%2F%2Fopencollective.com%2Fuser2&email=user2%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGtPqfd6Tn7n',
        object: 'customer',
        account_balance: 0,
        created: 1514499884,
        currency: null,
        default_source: 'card_1Be9nrLzdXg9xKNS56Z60ndx',
        delinquent: false,
        description: 'https://opencollective.com/user2',
        discount: null,
        email: 'user2@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9nrLzdXg9xKNS56Z60ndx',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGtPqfd6Tn7n',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: '1ePEQxDFh2TKt5lo',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGtPqfd6Tn7n/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGtPqfd6Tn7n/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:45 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_obC3YpzTXKiIKR',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/charges',
      'amount=5000&currency=USD&customer=cus_C2EGtPqfd6Tn7n&description=Donation%20to%20tipbox&application_fee=250&metadata%5Bfrom%5D=http%3A%2F%2Flocalhost%3A3000%2Fuser2&metadata%5Bto%5D=http%3A%2F%2Flocalhost%3A3000%2Ftipbox&metadata%5BcustomerEmail%5D=user2%40opencollective.com&metadata%5BPaymentMethodId%5D=3',
    )
    .reply(
      200,
      {
        id: 'ch_1Be9nuLzdXg9xKNSY2yXYiLm',
        object: 'charge',
        amount: 5000,
        amount_refunded: 0,
        application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
        application_fee: 'fee_1Be9nuLzdXg9xKNSfjSWKUvm',
        balance_transaction: 'txn_1Be9nuLzdXg9xKNSJvIAuy4F',
        captured: true,
        created: 1514499886,
        currency: 'usd',
        customer: 'cus_C2EGtPqfd6Tn7n',
        description: 'Donation to tipbox',
        destination: null,
        dispute: null,
        failure_code: null,
        failure_message: null,
        fraud_details: {},
        invoice: null,
        livemode: false,
        metadata: {
          from: 'http://localhost:3000/user2',
          to: 'http://localhost:3000/tipbox',
          customerEmail: 'user2@opencollective.com',
          PaymentMethodId: '3',
        },
        on_behalf_of: null,
        order: null,
        outcome: {
          network_status: 'approved_by_network',
          reason: null,
          risk_level: 'normal',
          seller_message: 'Payment complete.',
          type: 'authorized',
        },
        paid: true,
        receipt_email: null,
        receipt_number: null,
        refunded: false,
        refunds: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/charges/ch_1Be9nuLzdXg9xKNSY2yXYiLm/refunds',
        },
        review: null,
        shipping: null,
        source: {
          id: 'card_1Be9nrLzdXg9xKNS56Z60ndx',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          customer: 'cus_C2EGtPqfd6Tn7n',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        source_transfer: null,
        statement_descriptor: null,
        status: 'succeeded',
        transfer_group: null,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:46 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '2012',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_OKwqJ8WpNZ6aWC',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .get('/v1/balance/history/txn_1Be9nuLzdXg9xKNSJvIAuy4F')
    .reply(
      200,
      {
        id: 'txn_1Be9nuLzdXg9xKNSJvIAuy4F',
        object: 'balance_transaction',
        amount: 5000,
        available_on: 1514851200,
        created: 1514499886,
        currency: 'usd',
        description: 'Donation to tipbox',
        fee: 425,
        fee_details: [
          {
            amount: 175,
            application: null,
            currency: 'usd',
            description: 'Stripe processing fees',
            type: 'stripe_fee',
          },
          {
            amount: 250,
            application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
            currency: 'usd',
            description: 'OpenCollective application fee',
            type: 'application_fee',
          },
        ],
        net: 4575,
        source: 'ch_1Be9nuLzdXg9xKNSY2yXYiLm',
        sourced_transfers: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/transfers?source_transaction=ch_1Be9nuLzdXg9xKNSY2yXYiLm',
        },
        status: 'pending',
        type: 'charge',
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:47 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '902',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_jjOqjvimzbOI9h',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9noDjPFcHOcTmT574CrEv&description=https%3A%2F%2Fopencollective.com%2Fuser1&email=user1%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGFiFwLtYynS',
        object: 'customer',
        account_balance: 0,
        created: 1514499889,
        currency: null,
        default_source: 'card_1Be9nnDjPFcHOcTmEFRzpIXp',
        delinquent: false,
        description: 'https://opencollective.com/user1',
        discount: null,
        email: 'user1@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9nnDjPFcHOcTmEFRzpIXp',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGFiFwLtYynS',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: 'ftgJeBXvQSZ4HMCg',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGFiFwLtYynS/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGFiFwLtYynS/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:49 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_tvo2GR6hE0ohv6',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post('/v1/tokens', 'customer=cus_C2EGFiFwLtYynS')
    .reply(
      200,
      {
        id: 'tok_1Be9nyLzdXg9xKNSQwpdjpI1',
        object: 'token',
        card: {
          id: 'card_1Be9nyLzdXg9xKNSNhkGKoRH',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499890,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:50 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '776',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_3PSMloX6hYRGHv',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9nyLzdXg9xKNSQwpdjpI1&description=https%3A%2F%2Fopencollective.com%2Fuser1&email=user1%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGnc939AYoTW',
        object: 'customer',
        account_balance: 0,
        created: 1514499891,
        currency: null,
        default_source: 'card_1Be9nyLzdXg9xKNSNhkGKoRH',
        delinquent: false,
        description: 'https://opencollective.com/user1',
        discount: null,
        email: 'user1@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9nyLzdXg9xKNSNhkGKoRH',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGnc939AYoTW',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: '1ePEQxDFh2TKt5lo',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGnc939AYoTW/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGnc939AYoTW/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:51 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_HE9wOVsmrHPODa',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/charges',
      "amount=10000&currency=USD&customer=cus_C2EGnc939AYoTW&description=Matching%202x%20user2's%20donation&application_fee=500&metadata%5Bfrom%5D=http%3A%2F%2Flocalhost%3A3000%2Fuser1&metadata%5Bto%5D=http%3A%2F%2Flocalhost%3A3000%2Ftipbox&metadata%5BcustomerEmail%5D=user1%40opencollective.com&metadata%5BPaymentMethodId%5D=2",
    )
    .reply(
      200,
      {
        id: 'ch_1Be9o0LzdXg9xKNSwD3Ddh3v',
        object: 'charge',
        amount: 10000,
        amount_refunded: 0,
        application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
        application_fee: 'fee_1Be9o0LzdXg9xKNStkcUdrUw',
        balance_transaction: 'txn_1Be9o1LzdXg9xKNS7MzWRtuf',
        captured: true,
        created: 1514499892,
        currency: 'usd',
        customer: 'cus_C2EGnc939AYoTW',
        description: "Matching 2x user2's donation",
        destination: null,
        dispute: null,
        failure_code: null,
        failure_message: null,
        fraud_details: {},
        invoice: null,
        livemode: false,
        metadata: {
          from: 'http://localhost:3000/user1',
          to: 'http://localhost:3000/tipbox',
          customerEmail: 'user1@opencollective.com',
          PaymentMethodId: '2',
        },
        on_behalf_of: null,
        order: null,
        outcome: {
          network_status: 'approved_by_network',
          reason: null,
          risk_level: 'normal',
          seller_message: 'Payment complete.',
          type: 'authorized',
        },
        paid: true,
        receipt_email: null,
        receipt_number: null,
        refunded: false,
        refunds: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/charges/ch_1Be9o0LzdXg9xKNSwD3Ddh3v/refunds',
        },
        review: null,
        shipping: null,
        source: {
          id: 'card_1Be9nyLzdXg9xKNSNhkGKoRH',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          customer: 'cus_C2EGnc939AYoTW',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        source_transfer: null,
        statement_descriptor: null,
        status: 'succeeded',
        transfer_group: null,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:53 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '2023',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_mftZhqa4SARecq',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .get('/v1/balance/history/txn_1Be9o1LzdXg9xKNS7MzWRtuf')
    .reply(
      200,
      {
        id: 'txn_1Be9o1LzdXg9xKNS7MzWRtuf',
        object: 'balance_transaction',
        amount: 10000,
        available_on: 1514851200,
        created: 1514499892,
        currency: 'usd',
        description: "Matching 2x user2's donation",
        fee: 820,
        fee_details: [
          {
            amount: 320,
            application: null,
            currency: 'usd',
            description: 'Stripe processing fees',
            type: 'stripe_fee',
          },
          {
            amount: 500,
            application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
            currency: 'usd',
            description: 'OpenCollective application fee',
            type: 'application_fee',
          },
        ],
        net: 9180,
        source: 'ch_1Be9o0LzdXg9xKNSwD3Ddh3v',
        sourced_transfers: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/transfers?source_transaction=ch_1Be9o0LzdXg9xKNSwD3Ddh3v',
        },
        status: 'pending',
        type: 'charge',
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:54 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '913',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_hZ2fIfrxQraAxr',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/tokens',
      'card%5Bnumber%5D=4242424242424242&card%5Bexp_month%5D=12&card%5Bexp_year%5D=2028&card%5Bcvc%5D=222',
    )
    .reply(
      200,
      {
        id: 'tok_1Be9o6DjPFcHOcTmnFy5J649',
        object: 'token',
        card: {
          id: 'card_1Be9o5DjPFcHOcTmgTylJfvQ',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'unchecked',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: 'ftgJeBXvQSZ4HMCg',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499898,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:58 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '781',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_4eIMbhXr28KhRe',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/tokens',
      'card%5Bnumber%5D=4242424242424242&card%5Bexp_month%5D=12&card%5Bexp_year%5D=2028&card%5Bcvc%5D=222',
    )
    .reply(
      200,
      {
        id: 'tok_1Be9o6DjPFcHOcTmtFTxhdUk',
        object: 'token',
        card: {
          id: 'card_1Be9o6DjPFcHOcTmHvSYYziX',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'unchecked',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: 'ftgJeBXvQSZ4HMCg',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499898,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:24:58 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '781',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_WBhJC8wpHwdneO',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9o6DjPFcHOcTmtFTxhdUk&description=https%3A%2F%2Fopencollective.com%2Fuser2&email=user2%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EG7CCaN78hoK',
        object: 'customer',
        account_balance: 0,
        created: 1514499900,
        currency: null,
        default_source: 'card_1Be9o6DjPFcHOcTmHvSYYziX',
        delinquent: false,
        description: 'https://opencollective.com/user2',
        discount: null,
        email: 'user2@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9o6DjPFcHOcTmHvSYYziX',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EG7CCaN78hoK',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: 'ftgJeBXvQSZ4HMCg',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EG7CCaN78hoK/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EG7CCaN78hoK/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:00 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_WNccoZwduEHxxu',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post('/v1/tokens', 'customer=cus_C2EG7CCaN78hoK')
    .reply(
      200,
      {
        id: 'tok_1Be9o9LzdXg9xKNSY1M88rma',
        object: 'token',
        card: {
          id: 'card_1Be9o9LzdXg9xKNS6WvFKfKS',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499901,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:01 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '776',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_q85UOWKbL8T0LL',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9o9LzdXg9xKNSY1M88rma&description=https%3A%2F%2Fopencollective.com%2Fuser2&email=user2%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGcsJLVyktSW',
        object: 'customer',
        account_balance: 0,
        created: 1514499902,
        currency: null,
        default_source: 'card_1Be9o9LzdXg9xKNS6WvFKfKS',
        delinquent: false,
        description: 'https://opencollective.com/user2',
        discount: null,
        email: 'user2@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9o9LzdXg9xKNS6WvFKfKS',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGcsJLVyktSW',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: '1ePEQxDFh2TKt5lo',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGcsJLVyktSW/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGcsJLVyktSW/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:02 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_GzRUoQ0u6ThVvt',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/charges',
      'amount=5000&currency=USD&customer=cus_C2EGcsJLVyktSW&description=Monthly%20donation%20to%20tipbox&application_fee=250&metadata%5Bfrom%5D=http%3A%2F%2Flocalhost%3A3000%2Fuser2&metadata%5Bto%5D=http%3A%2F%2Flocalhost%3A3000%2Ftipbox&metadata%5BcustomerEmail%5D=user2%40opencollective.com&metadata%5BPaymentMethodId%5D=3',
    )
    .reply(
      200,
      {
        id: 'ch_1Be9oBLzdXg9xKNSbuabuxRz',
        object: 'charge',
        amount: 5000,
        amount_refunded: 0,
        application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
        application_fee: 'fee_1Be9oBLzdXg9xKNSwxGWuT8C',
        balance_transaction: 'txn_1Be9oCLzdXg9xKNS1sn1UUKA',
        captured: true,
        created: 1514499903,
        currency: 'usd',
        customer: 'cus_C2EGcsJLVyktSW',
        description: 'Monthly donation to tipbox',
        destination: null,
        dispute: null,
        failure_code: null,
        failure_message: null,
        fraud_details: {},
        invoice: null,
        livemode: false,
        metadata: {
          from: 'http://localhost:3000/user2',
          to: 'http://localhost:3000/tipbox',
          customerEmail: 'user2@opencollective.com',
          PaymentMethodId: '3',
        },
        on_behalf_of: null,
        order: null,
        outcome: {
          network_status: 'approved_by_network',
          reason: null,
          risk_level: 'normal',
          seller_message: 'Payment complete.',
          type: 'authorized',
        },
        paid: true,
        receipt_email: null,
        receipt_number: null,
        refunded: false,
        refunds: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/charges/ch_1Be9oBLzdXg9xKNSbuabuxRz/refunds',
        },
        review: null,
        shipping: null,
        source: {
          id: 'card_1Be9o9LzdXg9xKNS6WvFKfKS',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          customer: 'cus_C2EGcsJLVyktSW',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        source_transfer: null,
        statement_descriptor: null,
        status: 'succeeded',
        transfer_group: null,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:04 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '2020',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_w95g9AFbyGxASb',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .get('/v1/balance/history/txn_1Be9oCLzdXg9xKNS1sn1UUKA')
    .reply(
      200,
      {
        id: 'txn_1Be9oCLzdXg9xKNS1sn1UUKA',
        object: 'balance_transaction',
        amount: 5000,
        available_on: 1514851200,
        created: 1514499903,
        currency: 'usd',
        description: 'Monthly donation to tipbox',
        fee: 425,
        fee_details: [
          {
            amount: 175,
            application: null,
            currency: 'usd',
            description: 'Stripe processing fees',
            type: 'stripe_fee',
          },
          {
            amount: 250,
            application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
            currency: 'usd',
            description: 'OpenCollective application fee',
            type: 'application_fee',
          },
        ],
        net: 4575,
        source: 'ch_1Be9oBLzdXg9xKNSbuabuxRz',
        sourced_transfers: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/transfers?source_transaction=ch_1Be9oBLzdXg9xKNSbuabuxRz',
        },
        status: 'pending',
        type: 'charge',
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:05 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '910',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_FpcSxkL55kPtb5',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .get('/v1/plans/USD-MONTH-5000')
    .reply(
      200,
      {
        id: 'USD-MONTH-5000',
        object: 'plan',
        amount: 5000,
        created: 1506024318,
        currency: 'usd',
        interval: 'month',
        interval_count: 1,
        livemode: false,
        metadata: {},
        name: 'USD-MONTH-5000',
        statement_descriptor: null,
        trial_period_days: null,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:06 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '287',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_Y0lfiXhhPKY3d2',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers/cus_C2EGcsJLVyktSW/subscriptions',
      /plan=USD-MONTH-5000&application_fee_percent=5&trial_end=[0-9]{10}&metadata%5Bfrom%5D=http%3A%2F%2Flocalhost%3A3000%2Fuser2&metadata%5Bto%5D=http%3A%2F%2Flocalhost%3A3000%2Ftipbox&metadata%5BPaymentMethodId%5D=[0-9]/,
    )
    .reply(
      200,
      {
        id: 'sub_C2EGcV8i5UQAMx',
        object: 'subscription',
        application_fee_percent: 5,
        billing: 'charge_automatically',
        cancel_at_period_end: false,
        canceled_at: null,
        created: 1514499907,
        current_period_end: 1514845499,
        current_period_start: 1514499907,
        customer: 'cus_C2EGcsJLVyktSW',
        days_until_due: null,
        discount: null,
        ended_at: null,
        items: {
          object: 'list',
          data: [
            {
              id: 'si_C2EGkPBSEvnvAY',
              object: 'subscription_item',
              created: 1514499907,
              metadata: {},
              plan: {
                id: 'USD-MONTH-5000',
                object: 'plan',
                amount: 5000,
                created: 1506024318,
                currency: 'usd',
                interval: 'month',
                interval_count: 1,
                livemode: false,
                metadata: {},
                name: 'USD-MONTH-5000',
                statement_descriptor: null,
                trial_period_days: null,
              },
              quantity: 1,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/subscription_items?subscription=sub_C2EGcV8i5UQAMx',
        },
        livemode: false,
        metadata: {
          from: 'http://localhost:3000/user2',
          to: 'http://localhost:3000/tipbox',
          PaymentMethodId: '3',
        },
        plan: {
          id: 'USD-MONTH-5000',
          object: 'plan',
          amount: 5000,
          created: 1506024318,
          currency: 'usd',
          interval: 'month',
          interval_count: 1,
          livemode: false,
          metadata: {},
          name: 'USD-MONTH-5000',
          statement_descriptor: null,
          trial_period_days: null,
        },
        quantity: 1,
        start: 1514499907,
        status: 'trialing',
        tax_percent: null,
        trial_end: 1514845499,
        trial_start: 1514499907,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:07 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1759',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_OKk3fpODsMijIl',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9o6DjPFcHOcTmnFy5J649&description=https%3A%2F%2Fopencollective.com%2Fuser1&email=user1%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGiemXlG1MF0',
        object: 'customer',
        account_balance: 0,
        created: 1514499908,
        currency: null,
        default_source: 'card_1Be9o5DjPFcHOcTmgTylJfvQ',
        delinquent: false,
        description: 'https://opencollective.com/user1',
        discount: null,
        email: 'user1@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9o5DjPFcHOcTmgTylJfvQ',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGiemXlG1MF0',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: 'ftgJeBXvQSZ4HMCg',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGiemXlG1MF0/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGiemXlG1MF0/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:08 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_9V1gQiekN10fUq',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post('/v1/tokens', 'customer=cus_C2EGiemXlG1MF0')
    .reply(
      200,
      {
        id: 'tok_1Be9oILzdXg9xKNS8IxMy064',
        object: 'token',
        card: {
          id: 'card_1Be9oHLzdXg9xKNSmwQqS7Sm',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499910,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:10 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '776',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_kBwsFyKGkFMaLn',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/customers',
      'source=tok_1Be9oILzdXg9xKNS8IxMy064&description=https%3A%2F%2Fopencollective.com%2Fuser1&email=user1%40opencollective.com',
    )
    .reply(
      200,
      {
        id: 'cus_C2EGWU4rGIxBrh',
        object: 'customer',
        account_balance: 0,
        created: 1514499910,
        currency: null,
        default_source: 'card_1Be9oHLzdXg9xKNSmwQqS7Sm',
        delinquent: false,
        description: 'https://opencollective.com/user1',
        discount: null,
        email: 'user1@opencollective.com',
        livemode: false,
        metadata: {},
        shipping: null,
        sources: {
          object: 'list',
          data: [
            {
              id: 'card_1Be9oHLzdXg9xKNSmwQqS7Sm',
              object: 'card',
              address_city: null,
              address_country: null,
              address_line1: null,
              address_line1_check: null,
              address_line2: null,
              address_state: null,
              address_zip: null,
              address_zip_check: null,
              brand: 'Visa',
              country: 'US',
              customer: 'cus_C2EGWU4rGIxBrh',
              cvc_check: 'pass',
              dynamic_last4: null,
              exp_month: 12,
              exp_year: 2028,
              fingerprint: '1ePEQxDFh2TKt5lo',
              funding: 'credit',
              last4: '4242',
              metadata: {},
              name: null,
              tokenization_method: null,
            },
          ],
          has_more: false,
          total_count: 1,
          url: '/v1/customers/cus_C2EGWU4rGIxBrh/sources',
        },
        subscriptions: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/customers/cus_C2EGWU4rGIxBrh/subscriptions',
        },
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:11 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '1432',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_Ac3fIJNip9MyFz',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/charges',
      "amount=10000&currency=USD&customer=cus_C2EGWU4rGIxBrh&description=Matching%202x%20user2's%20donation&application_fee=500&metadata%5Bfrom%5D=http%3A%2F%2Flocalhost%3A3000%2Fuser1&metadata%5Bto%5D=http%3A%2F%2Flocalhost%3A3000%2Ftipbox&metadata%5BcustomerEmail%5D=user1%40opencollective.com&metadata%5BPaymentMethodId%5D=2",
    )
    .reply(
      200,
      {
        id: 'ch_1Be9oJLzdXg9xKNSNiWn1vnu',
        object: 'charge',
        amount: 10000,
        amount_refunded: 0,
        application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
        application_fee: 'fee_1Be9oKLzdXg9xKNSCJz6PKnC',
        balance_transaction: 'txn_1Be9oKLzdXg9xKNSnTOuC7Fd',
        captured: true,
        created: 1514499911,
        currency: 'usd',
        customer: 'cus_C2EGWU4rGIxBrh',
        description: "Matching 2x user2's donation",
        destination: null,
        dispute: null,
        failure_code: null,
        failure_message: null,
        fraud_details: {},
        invoice: null,
        livemode: false,
        metadata: {
          from: 'http://localhost:3000/user1',
          to: 'http://localhost:3000/tipbox',
          customerEmail: 'user1@opencollective.com',
          PaymentMethodId: '2',
        },
        on_behalf_of: null,
        order: null,
        outcome: {
          network_status: 'approved_by_network',
          reason: null,
          risk_level: 'normal',
          seller_message: 'Payment complete.',
          type: 'authorized',
        },
        paid: true,
        receipt_email: null,
        receipt_number: null,
        refunded: false,
        refunds: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/charges/ch_1Be9oJLzdXg9xKNSNiWn1vnu/refunds',
        },
        review: null,
        shipping: null,
        source: {
          id: 'card_1Be9oHLzdXg9xKNSmwQqS7Sm',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          customer: 'cus_C2EGWU4rGIxBrh',
          cvc_check: 'pass',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: '1ePEQxDFh2TKt5lo',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        source_transfer: null,
        statement_descriptor: null,
        status: 'succeeded',
        transfer_group: null,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:12 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '2023',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_kHiwbxRGNcUJrW',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .get('/v1/balance/history/txn_1Be9oKLzdXg9xKNSnTOuC7Fd')
    .reply(
      200,
      {
        id: 'txn_1Be9oKLzdXg9xKNSnTOuC7Fd',
        object: 'balance_transaction',
        amount: 10000,
        available_on: 1514851200,
        created: 1514499911,
        currency: 'usd',
        description: "Matching 2x user2's donation",
        fee: 820,
        fee_details: [
          {
            amount: 500,
            application: 'ca_68FQcZXEcV66Kjg7egLnR1Ce87cqwoue',
            currency: 'usd',
            description: 'OpenCollective application fee',
            type: 'application_fee',
          },
          {
            amount: 320,
            application: null,
            currency: 'usd',
            description: 'Stripe processing fees',
            type: 'stripe_fee',
          },
        ],
        net: 9180,
        source: 'ch_1Be9oJLzdXg9xKNSNiWn1vnu',
        sourced_transfers: {
          object: 'list',
          data: [],
          has_more: false,
          total_count: 0,
          url: '/v1/transfers?source_transaction=ch_1Be9oJLzdXg9xKNSNiWn1vnu',
        },
        status: 'pending',
        type: 'charge',
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:13 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '913',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_5WZsHMa3IziwGD',
        'Stripe-Account',
        'acct_18KWlTLzdXg9xKNS',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/tokens',
      'card%5Bnumber%5D=4242424242424242&card%5Bexp_month%5D=12&card%5Bexp_year%5D=2028&card%5Bcvc%5D=222',
    )
    .reply(
      200,
      {
        id: 'tok_1Be9oODjPFcHOcTmEloHGqCc',
        object: 'token',
        card: {
          id: 'card_1Be9oODjPFcHOcTmS3BHFBiQ',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'unchecked',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: 'ftgJeBXvQSZ4HMCg',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499916,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:16 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '781',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_pvUIIx1XAtAZOG',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );

  nock('https://api.stripe.com:443', { encodedQueryParams: true })
    .post(
      '/v1/tokens',
      'card%5Bnumber%5D=4242424242424242&card%5Bexp_month%5D=12&card%5Bexp_year%5D=2028&card%5Bcvc%5D=222',
    )
    .reply(
      200,
      {
        id: 'tok_1Be9oPDjPFcHOcTmp7ErG35w',
        object: 'token',
        card: {
          id: 'card_1Be9oPDjPFcHOcTmuOCqHsWa',
          object: 'card',
          address_city: null,
          address_country: null,
          address_line1: null,
          address_line1_check: null,
          address_line2: null,
          address_state: null,
          address_zip: null,
          address_zip_check: null,
          brand: 'Visa',
          country: 'US',
          cvc_check: 'unchecked',
          dynamic_last4: null,
          exp_month: 12,
          exp_year: 2028,
          fingerprint: 'ftgJeBXvQSZ4HMCg',
          funding: 'credit',
          last4: '4242',
          metadata: {},
          name: null,
          tokenization_method: null,
        },
        client_ip: '80.200.13.130',
        created: 1514499917,
        livemode: false,
        type: 'card',
        used: false,
      },
      [
        'Server',
        'nginx',
        'Date',
        'Thu, 28 Dec 2017 22:25:17 GMT',
        'Content-Type',
        'application/json',
        'Content-Length',
        '781',
        'Connection',
        'close',
        'Access-Control-Allow-Credentials',
        'true',
        'Access-Control-Allow-Methods',
        'GET, POST, HEAD, OPTIONS, DELETE',
        'Access-Control-Allow-Origin',
        '*',
        'Access-Control-Expose-Headers',
        'X-Stripe-Privileged-Session-Required,stripe-manage-version,X-Stripe-External-Auth-Required',
        'Access-Control-Max-Age',
        '300',
        'Cache-Control',
        'no-cache, no-store',
        'Request-Id',
        'req_0j9ums73UWbfmL',
        'Stripe-Version',
        '2015-04-07',
        'Strict-Transport-Security',
        'max-age=31556926; includeSubDomains; preload',
      ],
    );
}
